/*!
 * CanJS - 2.0.5
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Tue, 04 Feb 2014 22:36:26 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/util/library","can/map","can/list"],function(t){return t.each([t.Map,t.Model],function(e){if(void 0!==e){var n=function(t){return"object"==typeof t&&null!==t&&t};t.extend(e,{attributes:{},convert:{date:function(t){var e=typeof t;return"string"===e?(t=Date.parse(t),isNaN(t)?null:new Date(t)):"number"===e?new Date(t):t},number:function(t){return parseFloat(t)},"boolean":function(t){return"false"!==t&&"0"!==t&&t?!0:!1},"default":function(e,n,i,r){if(t.Map.prototype.isPrototypeOf(r.prototype)&&"function"==typeof r.model&&"function"==typeof r.models)return r[t.isArray(e)?"models":"model"](e);if(t.Map.prototype.isPrototypeOf(r.prototype))return t.isArray(e)&&"function"==typeof r.List?new r.List(e):new r(e);if("function"==typeof r)return r(e,n);var o,a=t.getObject(r),s=window;return r.indexOf(".")>=0&&(o=r.substring(0,r.lastIndexOf(".")),s=t.getObject(o)),"function"==typeof a?a.call(s,e,n):e}},serialize:{"default":function(t){return n(t)&&t.serialize?t.serialize():t},date:function(t){return t&&t.getTime()}}});var i=e.setup;e.setup=function(e,n,r){var o=this;i.call(o,e,n,r),t.each(["attributes"],function(t){o[t]&&e[t]!==o[t]||(o[t]={})}),t.each(["convert","serialize"],function(n){e[n]!==o[n]&&(o[n]=t.extend({},e[n],o[n]))})}}}),t.Map.prototype.__convert=function(t,e){var n,i,r=this.constructor,o=this.attr(t);return r.attributes&&(n=r.attributes[t],i=r.convert[n]||r.convert["default"]),null!==e&&n?i.call(r,e,o,function(){},n):e},t.List.prototype.serialize=function(){return t.makeArray(t.Map.prototype.serialize.apply(this,arguments))},t.Map.prototype.serialize=function(e,n){var i={},r=this.constructor,o={};return n=t.isArray(n)?n:[],n.push(this._cid),void 0!==e?o[e]=this[e]:o=this.__get(),t.each(o,function(e,o){var a,s;e instanceof t.Map&&t.inArray(e._cid,n)>-1?i[o]=e.attr("id"):(a=r.attributes?r.attributes[o]:0,s=r.serialize?r.serialize[a]:0,i[o]=e&&"function"==typeof e.serialize?e.serialize(void 0,n):s?s(e,a):e)}),"undefined"!=typeof o.length&&(i.length=o.length),void 0!==e?i[e]:i},t.Map});