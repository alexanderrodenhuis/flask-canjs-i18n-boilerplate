/*!
 * CanJS - 2.0.4
 * http://canjs.us/
 * Copyright (c) 2013 Bitovi
 * Mon, 23 Dec 2013 19:49:14 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/util/library","can/map","can/list"],function(t){return t.each([t.Map,t.Model],function(e){if(void 0!==e){var n=function(t){return"object"==typeof t&&null!==t&&t};t.extend(e,{attributes:{},convert:{date:function(t){var e=typeof t;return"string"===e?(t=Date.parse(t),isNaN(t)?null:new Date(t)):"number"===e?new Date(t):t},number:function(t){return parseFloat(t)},"boolean":function(t){return"false"!==t&&"0"!==t&&t?!0:!1},"default":function(e,n,r,i){if(t.Map.prototype.isPrototypeOf(i.prototype)&&"function"==typeof i.model&&"function"==typeof i.models)return i[t.isArray(e)?"models":"model"](e);if(t.Map.prototype.isPrototypeOf(i.prototype))return t.isArray(e)&&"function"==typeof i.List?new i.List(e):new i(e);if("function"==typeof i)return i(e,n);var o,a=t.getObject(i),s=window;return i.indexOf(".")>=0&&(o=i.substring(0,i.lastIndexOf(".")),s=t.getObject(o)),"function"==typeof a?a.call(s,e,n):e}},serialize:{"default":function(t){return n(t)&&t.serialize?t.serialize():t},date:function(t){return t&&t.getTime()}}});var r=e.setup;e.setup=function(e,n,i){var o=this;r.call(o,e,n,i),t.each(["attributes"],function(t){o[t]&&e[t]!==o[t]||(o[t]={})}),t.each(["convert","serialize"],function(n){e[n]!=o[n]&&(o[n]=t.extend({},e[n],o[n]))})}}}),t.Map.prototype.__convert=function(t,e){var n,r,i=this.constructor,o=this.attr(t);return i.attributes&&(n=i.attributes[t],r=i.convert[n]||i.convert["default"]),null!==e&&n?r.call(i,e,o,function(){},n):e},t.List.prototype.serialize=function(){return t.makeArray(t.Map.prototype.serialize.apply(this,arguments))},t.Map.prototype.serialize=function(e,n){var r={},i=this.constructor,o={};return n=t.isArray(n)?n:[],n.push(this._cid),void 0!==e?o[e]=this[e]:o=this.__get(),t.each(o,function(e,o){var a,s;e instanceof t.Map&&t.inArray(e._cid,n)>-1?r[o]=e.attr("id"):(a=i.attributes?i.attributes[o]:0,s=i.serialize?i.serialize[a]:0,r[o]=e&&"function"==typeof e.serialize?e.serialize(void 0,n):s?s(e,a):e)}),"undefined"!=typeof o.length&&(r.length=o.length),void 0!=e?r[e]:r},t.Map});