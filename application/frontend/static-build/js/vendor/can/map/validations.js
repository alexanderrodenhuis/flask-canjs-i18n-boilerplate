/*!
 * CanJS - 2.0.5
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Tue, 04 Feb 2014 22:36:26 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

define(["can/util/library","can/map/attributes"],function(t){var e=function(e,n,i){if(i||(i=n,n={}),n=n||{},e="string"==typeof e?[e]:t.makeArray(e),!n.testIf||n.testIf.call(this)){var r=this;t.each(e,function(t){r.validations[t]||(r.validations[t]=[]),r.validations[t].push(function(e){var r=i.call(this,e,t);return void 0===r?void 0:n.message||r})})}},n=t.Map.prototype.__set;return t.Map.prototype.__set=function(e,i,r,o,a){var s=this,u=s.constructor.validations,l=function(n){var i=a&&a.call(s,n);return i!==!1&&t.trigger(s,"error",[e,n],!0),!1};if(n.call(s,e,i,r,o,l),u&&u[e]){var c=s.errors(e);c&&l(c)}return this},t.each([t.Map,t.Model],function(n){if(void 0!==n){var i=n.setup;t.extend(n,{setup:function(t){i.apply(this,arguments),this.validations&&t.validations!==this.validations||(this.validations={})},validate:e,validationMessages:{format:"is invalid",inclusion:"is not a valid option (perhaps out of range)",lengthShort:"is too short",lengthLong:"is too long",presence:"can't be empty",range:"is out of range",numericality:"must be a number"},validateFormatOf:function(t,n,i){e.call(this,t,i,function(t){return"undefined"!=typeof t&&null!==t&&""!==t&&null===String(t).match(n)?this.constructor.validationMessages.format:void 0})},validateInclusionOf:function(t,n,i){e.call(this,t,i,function(t){if("undefined"!=typeof t){for(var e=0;e<n.length;e++)if(n[e]===t)return;return this.constructor.validationMessages.inclusion}})},validateLengthOf:function(t,n,i,r){e.call(this,t,r,function(t){return("undefined"==typeof t||null===t)&&n>0||"undefined"!=typeof t&&null!==t&&t.length<n?this.constructor.validationMessages.lengthShort+" (min="+n+")":"undefined"!=typeof t&&null!==t&&t.length>i?this.constructor.validationMessages.lengthLong+" (max="+i+")":void 0})},validatePresenceOf:function(t,n){e.call(this,t,n,function(t){return"undefined"==typeof t||""===t||null===t?this.constructor.validationMessages.presence:void 0})},validateRangeOf:function(t,n,i,r){e.call(this,t,r,function(t){return("undefined"==typeof t||null===t)&&n>0||"undefined"!=typeof t&&null!==t&&(n>t||t>i)?this.constructor.validationMessages.range+" ["+n+","+i+"]":void 0})},validatesNumericalityOf:function(t){e.call(this,t,function(t){var e=!isNaN(parseFloat(t))&&isFinite(t);return e?void 0:this.constructor.validationMessages.numericality})}})}}),t.extend(t.Map.prototype,{errors:function(e,n){e&&(e=t.isArray(e)?e:[e]);var i={},r=this,o=function(e,o){t.each(o,function(t){var o=t.call(r,s?r.__convert?r.__convert(e,n):n:r.attr(e));o&&(i[e]||(i[e]=[]),i[e].push(o))})},a=this.constructor.validations,s=e&&1===e.length&&2===arguments.length;return t.each(e||a||{},function(t,e){"number"==typeof e&&(e=t,t=a[e]),o(e,t||[])}),t.isEmptyObject(i)?null:s?i[e[0]]:i}}),t.Map});