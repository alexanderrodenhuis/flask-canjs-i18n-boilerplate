define(["jquery","can/util/library","can/control"],function(t,e){var n,r=function(t,e){for(n=0;n<e.length;n++)if("string"==typeof e[n]?t.constructor._shortName==e[n]:t instanceof e[n])return!0;return!1},i=e.makeArray,o=e.Control.setup;return e.Control.setup=function(){if(this!==e.Control){var t=this.pluginName||this._fullName;"can_control"!==t&&this.plugin(t),o.apply(this,arguments)}},t.fn.extend({controls:function(){var t,n,o=i(arguments),s=[];return this.each(function(){if(t=e.$(this).data("controls"))for(var i=0;i<t.length;i++)n=t[i],(!o.length||r(n,o))&&s.push(n)}),s},control:function(){return this.controls.apply(this,arguments)[0]}}),e.Control.plugin=function(n){var r=this;t.fn[n]||(t.fn[n]=function(n){var o,s=i(arguments),a="string"==typeof n&&t.isFunction(r.prototype[n]),u=s[0];return this.each(function(){var t=e.$(this).control(r);t?a?o=t[u].apply(t,s.slice(1)):t.update.apply(t,s):r.newInstance.apply(r,[this].concat(s))}),void 0!==o?o:this})},e.Control.prototype.update=function(t){e.extend(this.options,t),this.on()},e});