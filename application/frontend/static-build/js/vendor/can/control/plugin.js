define(["jquery","can/util/library","can/control"],function(e,t){var n,r=function(e,t){for(n=0;n<t.length;n++)if("string"==typeof t[n]?e.constructor._shortName==t[n]:e instanceof t[n])return!0;return!1},i=t.makeArray,o=t.Control.setup;return t.Control.setup=function(){if(this!==t.Control){var e=this.pluginName||this._fullName;"can_control"!==e&&this.plugin(e),o.apply(this,arguments)}},e.fn.extend({controls:function(){var e,n,o=i(arguments),s=[];return this.each(function(){if(e=t.$(this).data("controls"))for(var i=0;i<e.length;i++)n=e[i],(!o.length||r(n,o))&&s.push(n)}),s},control:function(){return this.controls.apply(this,arguments)[0]}}),t.Control.plugin=function(n){var r=this;e.fn[n]||(e.fn[n]=function(n){var o,s=i(arguments),a="string"==typeof n&&e.isFunction(r.prototype[n]),u=s[0];return this.each(function(){var e=t.$(this).control(r);e?a?o=e[u].apply(e,s.slice(1)):e.update.apply(e,s):r.newInstance.apply(r,[this].concat(s))}),void 0!==o?o:this})},t.Control.prototype.update=function(e){t.extend(this.options,e),this.on()},t});